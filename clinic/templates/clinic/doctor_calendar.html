{% extends 'clinic/base.html' %}

{% block content %}
<div style="max-width: 1000px; margin: 40px auto; padding: 20px;">
    
    <!-- –®–∞–ø–∫–∞ —Å –≤—ã–±–æ—Ä–æ–º –¥–∞—Ç—ã -->
    <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 20px; margin-bottom: 30px;">
        <div>
            <h2 style="margin: 0;">üìÖ –ñ—É—Ä–Ω–∞–ª –∑–∞–ø–∏—Å–µ–π</h2>
            <p style="color: gray; margin-top: 5px;">–ü—Ä–æ—Å–º–æ—Ç—Ä –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤ –∑–∞ –ª—é–±–æ–π –¥–µ–Ω—å</p>
        </div>
        
        <!-- –§–æ—Ä–º–∞ –≤—ã–±–æ—Ä–∞ –¥–∞—Ç—ã -->
        <form method="get" style="display: flex; gap: 10px; align-items: center; background: white; padding: 10px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05);">
            <label for="date-picker" style="font-weight: bold;">–î–∞—Ç–∞:</label>
            <!-- onchange –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç —Ñ–æ—Ä–º—É –ø—Ä–∏ –≤—ã–±–æ—Ä–µ –¥–∞—Ç—ã -->
            <input type="date" id="date-picker" name="date" 
                   value="{{ selected_date|date:'Y-m-d' }}" 
                   onchange="this.form.submit()"
                   style="padding: 8px; border: 1px solid #ccc; border-radius: 5px;">
            
            <noscript><button type="submit">–ü–æ–∫–∞–∑–∞—Ç—å</button></noscript>
        </form>
    </div>

    <!-- –ë—ã—Å—Ç—Ä–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è -->
    <div style="margin-bottom: 20px; display: flex; gap: 10px;">
        <a href="?date={{ today|date:'Y-m-d' }}" class="btn btn-outline" style="font-size: 0.9rem;">
            –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –°–µ–≥–æ–¥–Ω—è
        </a>
    </div>

    <!-- –¢–∞–±–ª–∏—Ü–∞ –∑–∞–ø–∏—Å–µ–π -->
    <div style="background: white; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); overflow: hidden;">
        <div style="padding: 20px; background: #e3f2fd; border-bottom: 1px solid #bbdefb;">
            <h3 style="margin: 0; color: #0056b3;">
                –ó–∞–ø–∏—Å–∏ –Ω–∞ {{ selected_date|date:"d E Y" }} 
                {% if selected_date == today %}(–°–µ–≥–æ–¥–Ω—è){% endif %}
            </h3>
        </div>

        <table style="width: 100%; border-collapse: collapse;">
            <thead>
                <tr style="background: #f8f9fa; text-align: left;">
                    <th style="padding: 15px;">–í—Ä–µ–º—è</th>
                    <th style="padding: 15px;">–ü–∞—Ü–∏–µ–Ω—Ç</th>
                    <th style="padding: 15px;">–ö–∞–±–∏–Ω–µ—Ç</th>
                    <th style="padding: 15px;">–°—Ç–∞—Ç—É—Å / –î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
            </thead>
            <tbody>
                {% for appt in appointments %}
                <tr style="border-bottom: 1px solid #eee;">
                    <td style="padding: 15px; font-weight: bold; color: #333;">
                        {{ appt.visit_time|date:"H:i" }}
                    </td>
                    <td style="padding: 15px;">
                        {{ appt.patient.full_name }} <br>
                        <small style="color: gray;">–î.–†.: {{ appt.patient.birth_date|date:"d.m.Y" }}</small>
                    </td>
                    <td style="padding: 15px;">{{ appt.cabinet }}</td>
                    <td style="padding: 15px;">
                        <!-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ä–µ—Ü–µ–ø—Ç -->
                        {% if appt.get_prescription %}
                            <a href="{% url 'add_prescription' appt.id_rec %}" 
                               style="color: #856404; background: #fff3cd; padding: 5px 10px; border-radius: 4px; text-decoration: none; font-size: 0.9em;">
                               ‚úèÔ∏è –†–µ—Ü–µ–ø—Ç –≤—ã–ø–∏—Å–∞–Ω
                            </a>
                        {% else %}
                            <!-- –ö–Ω–æ–ø–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–∞, –µ—Å–ª–∏ –¥–∞—Ç–∞ <= —Å–µ–≥–æ–¥–Ω—è (–Ω–µ–ª—å–∑—è –≤—ã–ø–∏—Å–∞—Ç—å –Ω–∞ –∑–∞–≤—Ç—Ä–∞) -->
                            {% if selected_date <= today %}
                                <a href="{% url 'add_prescription' appt.id_rec %}" 
                                   style="color: white; background: #17a2b8; padding: 5px 10px; border-radius: 4px; text-decoration: none; font-size: 0.9em;">
                                   üíä –í—ã–ø–∏—Å–∞—Ç—å
                                </a>
                            {% else %}
                                <span style="color: gray; font-size: 0.9em;">(–ü—Ä–∏–µ–º –µ—â–µ –Ω–µ –Ω–∞—Å—Ç—É–ø–∏–ª)</span>
                            {% endif %}
                        {% endif %}
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="4" style="padding: 40px; text-align: center; color: gray;">
                        –ù–∞ —ç—Ç–æ—Ç –¥–µ–Ω—å –∑–∞–ø–∏—Å–µ–π –Ω–µ—Ç.
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <div style="margin-top: 30px;">
        <a href="{% url 'profile' %}" style="color: gray; text-decoration: none;">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –∫–∞–±–∏–Ω–µ—Ç</a>
    </div>
</div>
{% endblock %}