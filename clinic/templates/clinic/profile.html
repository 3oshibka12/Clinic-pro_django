{% extends 'clinic/base.html' %}

{% block content %}
<div style="max-width: 900px; margin: 0 auto; padding: 20px;">

         <!-- 1. –ò–ù–¢–ï–†–§–ï–ô–° –ú–ï–ù–ï–î–ñ–ï–†–ê (–ü–µ—Ä—Å–æ–Ω–∞–ª) -->
    {% if role == 'manager' %}
        <div style="background-color: #f8f9fa; padding: 20px; border-radius: 8px;">
            <h2>üõ† –ö–∞–±–∏–Ω–µ—Ç –ú–µ–Ω–µ–¥–∂–µ—Ä–∞</h2>
            <p>–í—ã –≤–æ—à–ª–∏ –∫–∞–∫ –ø–µ—Ä—Å–æ–Ω–∞–ª. <a href="{% url 'admin:index' %}">–ü–µ—Ä–µ–π—Ç–∏ –≤ –ê–¥–º–∏–Ω–∫—É</a></p>
            
            <a href="{% url 'add_schedule' %}" style="display:inline-block; margin: 10px 0; padding: 10px 15px; background: #007bff; color: white; text-decoration: none; border-radius: 4px;">
                + –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º
            </a>

            <h3>–ü–æ—Å–ª–µ–¥–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–∏:</h3>
            <ul>
                {% for sch in schedules %}
                    <li>{{ sch.doctor.lname }} ‚Äî {{ sch.get_day_display }} ({{ sch.time_start }} - {{ sch.time_end }})</li>
                {% endfor %}
            </ul>
        </div>


         <!-- 2. –ò–ù–¢–ï–†–§–ï–ô–° –í–†–ê–ß–ê -->
         {% elif role == 'doctor' %}
         <div style="background-color: #f1f8ff; padding: 25px; border-radius: 10px; border: 1px solid #cce5ff;">
             
             <div style="display: flex; justify-content: space-between; align-items: center;">
                 <div>
                     <h2>–ö–∞–±–∏–Ω–µ—Ç –í—Ä–∞—á–∞</h2>
                     <p style="margin: 0;"><strong>{{ doctor.full_name }}</strong> ({{ doctor.specialization }})</p>
                 </div>
                 
                 <!-- –ö–ù–û–ü–ö–ê –ü–ï–†–ï–•–û–î–ê –í –ö–ê–õ–ï–ù–î–ê–†–¨ -->
                 <a href="{% url 'doctor_calendar' %}" class="btn" style="background: white; color: #0056b3; border: 1px solid #0056b3;">
                     üìÖ –û—Ç–∫—Ä—ã—Ç—å –∂—É—Ä–Ω–∞–ª –∑–∞–ø–∏—Å–µ–π
                 </a>
             </div>
             
             <hr style="margin: 20px 0;">
 
             <h3 style="color: #0056b3;">‚ö°Ô∏è –ü–ª–∞–Ω –Ω–∞ —Å–µ–≥–æ–¥–Ω—è ({{ now|date:"d E" }}):</h3>
             
             {% if appointments_today %}
                 <ul style="list-style: none; padding: 0;">
                 {% for appt in appointments_today %}
                     <!-- –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –±–ª–∏–∂–∞–π—à–∏–π –ø—Ä–∏–µ–º (–µ—Å–ª–∏ –≤—Ä–µ–º—è > —Å–µ–π—á–∞—Å) -->
                     {% now "Y-m-d H:i" as current_time %}
                     
                     <li style="background: white; padding: 15px; margin-bottom: 10px; border-radius: 6px; 
                                box-shadow: 0 2px 4px rgba(0,0,0,0.05); 
                                border-left: 5px solid {% if appt.visit_time|date:'Y-m-d H:i' < current_time %}#6c757d{% else %}#28a745{% endif %};">
                         <div style="display: flex; justify-content: space-between; align-items: center;">
                             <div>
                                 <strong style="font-size: 1.2em;">{{ appt.visit_time|date:"H:i" }}</strong>
                                 <span style="margin-left: 10px;">{{ appt.patient.full_name }}</span>
                             </div>
                             
                             <!-- –ë—ã—Å—Ç—Ä–∞—è –∫–Ω–æ–ø–∫–∞ —Ä–µ—Ü–µ–ø—Ç–∞ -->
                             {% if appt.get_prescription %}
                                 <a href="{% url 'add_prescription' appt.id_rec %}" style="text-decoration: none;">‚úèÔ∏è</a>
                             {% else %}
                                 <a href="{% url 'add_prescription' appt.id_rec %}" style="text-decoration: none;">üíä</a>
                             {% endif %}
                         </div>
                     </li>
                 {% endfor %}
                 </ul>
             {% else %}
                 <div style="text-align: center; padding: 30px; background: white; border-radius: 8px; color: gray;">
                     –ù–∞ —Å–µ–≥–æ–¥–Ω—è –ø—Ä–∏–µ–º–æ–≤ –±–æ–ª—å—à–µ –Ω–µ—Ç. –û—Ç–¥–æ—Ö–Ω–∏—Ç–µ! ‚òï
                 </div>
             {% endif %}
         </div>


         <!-- 3. –ò–ù–¢–ï–†–§–ï–ô–° –ü–ê–¶–ò–ï–ù–¢–ê -->
    <!-- clinic/templates/clinic/profile.html -->

    {% elif role == 'patient' %}
        <div style="background-color: #fff3cd; padding: 25px; border-radius: 10px; border: 1px solid #ffeeba;">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <h2>–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</h2>
                    <p style="margin: 0;"><strong>{{ patient.fname }} {{ patient.lname }}</strong> (–£—á–∞—Å—Ç–æ–∫ ‚Ññ{{ patient.region }})</p>
                </div>
                
                <!-- –ö–Ω–æ–ø–∫–∞ –ò—Å—Ç–æ—Ä–∏–∏ -->
                <a href="{% url 'patient_history' %}" class="btn" style="background: white; color: #333; border: 1px solid #ccc;">
                    üìÇ –ú–æ—è –∏—Å—Ç–æ—Ä–∏—è –±–æ–ª–µ–∑–Ω–∏
                </a>
            </div>

            <hr style="margin: 20px 0; border-top: 1px solid #e6dbb9;">

            <div style="margin-bottom: 20px;">
                <a href="{% url 'find_doctor' %}" class="btn btn-primary" style="font-weight: bold; width: 100%; box-sizing: border-box; text-align: center;">
                    + –ó–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –Ω–æ–≤—ã–π –ø—Ä–∏–µ–º
                </a>
            </div>

            <h3 style="color: #856404;">‚è≥ –ë–ª–∏–∂–∞–π—à–∏–µ –∑–∞–ø–∏—Å–∏:</h3>
            
            {% if my_appointments %}
                <ul style="list-style: none; padding: 0;">
                {% for appt in my_appointments %}
                    <li style="background: white; padding: 20px; margin-bottom: 15px; border-radius: 8px; border-left: 5px solid #ffc107; box-shadow: 0 2px 5px rgba(0,0,0,0.05);">
                        <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px;">
                            
                            <!-- –ò–Ω—Ñ–æ -->
                            <div>
                                <div style="font-size: 1.2em; font-weight: bold; color: #333; margin-bottom: 5px;">
                                    {{ appt.visit_time|date:"d E (l) –≤ H:i" }}
                                </div>
                                <div>üë®‚Äç‚öïÔ∏è {{ appt.doctor_info }}</div>
                                <div style="color: gray;">üö™ –ö–∞–±–∏–Ω–µ—Ç: {{ appt.cabinet }}</div>
                            </div>

                            <!-- –ö–Ω–æ–ø–∫–∞ –æ—Ç–º–µ–Ω—ã -->
                            <form action="{% url 'cancel_appointment' appt.id_rec %}" method="post" onsubmit="return confirm('–û—Ç–º–µ–Ω–∏—Ç—å —ç—Ç—É –∑–∞–ø–∏—Å—å?');">
                                {% csrf_token %}
                                <button type="submit" style="background: white; border: 1px solid #dc3545; color: #dc3545; padding: 8px 15px; border-radius: 5px; cursor: pointer; font-weight: bold;">
                                    ‚ùå –û—Ç–º–µ–Ω–∏—Ç—å
                                </button>
                            </form>
                        </div>
                    </li>
                {% endfor %}
                </ul>
            {% else %}
                <p style="color: #856404;">–£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏—Ö –ø—Ä–∏–µ–º–æ–≤.</p>
            {% endif %}
        </div>


         <!-- 4. –û–®–ò–ë–ö–ê / –ù–ï–¢ –†–û–õ–ò -->
    {% else %}
        <div style="padding: 20px; border: 2px solid red; color: red; background: #fff0f0; border-radius: 8px;">
            <h3>üìõ –û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞</h3>
            <p>–í–∞—à –ø—Ä–æ—Ñ–∏–ª—å –Ω–µ —Å–≤—è–∑–∞–Ω –Ω–∏ —Å –≤—Ä–∞—á–æ–º, –Ω–∏ —Å –ø–∞—Ü–∏–µ–Ω—Ç–æ–º.</p>
            <p>–û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É.</p>
        </div>
    {% endif %} 
    
    <div style="margin-top: 30px; text-align: center;">
        <a href="{% url 'logout' %}" style="color: #6c757d; text-decoration: underline;">–í—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞</a>
    </div>

</div>
{% endblock %}