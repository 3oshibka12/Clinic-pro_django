{% extends 'clinic/base.html' %}

{% block content %}
<div style="max-width: 900px; margin: 0 auto; padding: 20px;">
    <h2>Запись к врачу: {{ doctor.full_name }}</h2>
    <p class="text-muted">{{ doctor.specialization }} | Кабинет уточняйте в регистратуре</p>
    <hr>

    {% if messages %}
        {% for message in messages %}
            <div style="padding: 10px; background-color: #d4edda; color: #155724; margin-bottom: 15px; border-radius: 5px;">
                {{ message }}
            </div>
        {% endfor %}
    {% endif %}

    <div style="display: flex; flex-direction: column; gap: 20px;">
        {% for day_info in week_schedule %}
            <div style="border: 1px solid #ddd; border-radius: 8px; padding: 15px; background: #fff;">
                <!-- Заголовок дня -->
                <h3 style="margin-top: 0; border-bottom: 1px solid #eee; padding-bottom: 10px;">
                    {{ day_info.date|date:"d E, l" }} 
                </h3>

                <!-- Список слотов -->
                <div style="display: flex; flex-wrap: wrap; gap: 10px;">
                    {% if day_info.slots %}
                        {% for slot in day_info.slots %}
                            <form method="POST" action="" onsubmit="return confirm('Записаться на {{ slot|time:'H:i' }}?');">
                                {% csrf_token %}
                                <input type="hidden" name="visit_date" value="{{ day_info.date|date:'Y-m-d' }}">
                                <input type="hidden" name="visit_time" value="{{ slot|time:'H:i' }}">
                                
                                <button type="submit" 
                                        style="padding: 8px 15px; 
                                               background-color: #28a745; 
                                               color: white; 
                                               border: none; 
                                               border-radius: 4px; 
                                               cursor: pointer; 
                                               font-size: 14px;">
                                    {{ slot|time:"H:i" }}
                                </button>
                            </form>
                        {% endfor %}
                    {% else %}
                        <p style="color: gray; margin: 0;">Нет свободных мест или прием не ведется</p>
                    {% endif %}
                </div>
            </div>
        {% endfor %}
    </div>

    <br>
    <a href="{% url 'find_doctor' %}">← Вернуться к выбору врача</a>
</div>
{% endblock %}